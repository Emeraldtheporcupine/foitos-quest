namespace SpriteKind {
    export const HUD = SpriteKind.create()
    export const BackgroundTree = SpriteKind.create()
    export const Fling = SpriteKind.create()
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Cutscene == false) {
        if (Character.vy == 0) {
            Character.vy = -100
        }
    }
})
function SpawnStuff () {
    Tree = sprites.create(assets.image`tree`, SpriteKind.BackgroundTree)
    tiles.placeOnTile(Tree, tiles.getTileLocation(76, 6))
    Tree.z = -2
    for (let AppleSpawn of tiles.getTilesByType(assets.tile`AppleSpawn`)) {
        AppleSprite = sprites.create(assets.image`Apple`, SpriteKind.Food)
        tiles.placeOnTile(AppleSprite, AppleSpawn)
        AppleSprite.ay = 300
        AppleSprite.x += randint(0, -8)
        AppleSprite2 = sprites.create(assets.image`Apple`, SpriteKind.Food)
        tiles.placeOnTile(AppleSprite2, AppleSpawn)
        AppleSprite2.ay = 300
        AppleSprite2.x += randint(0, 7)
        tiles.setTileAt(AppleSpawn, assets.tile`G1-2`)
    }
}
function SetupAnim () {
    characterAnimations.loopFrames(
    Character,
    assets.animation`IdleR`,
    200,
    characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`IdleL`,
    200,
    characterAnimations.rule(Predicate.NotMoving, Predicate.FacingLeft)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`WalkR`,
    100,
    characterAnimations.rule(Predicate.Moving, Predicate.FacingRight)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`WalkL`,
    100,
    characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft)
    )
}
scene.onOverlapTile(SpriteKind.Player, assets.tile`transparency16`, function (sprite, location) {
    if (Character.tilemapLocation().column == 79 && Character.tilemapLocation().row == 7 && Cutscene == false) {
        music.stopAllSounds()
        Cutscene = true
        CutSprite.z = 2
        animation.runImageAnimation(
        CutSprite,
        assets.animation`Cutscene Bars`,
        100,
        false
        )
        music.play(music.createSong(assets.song`Cutscene 1`), music.PlaybackMode.LoopingInBackground)
        timer.after(1000, function () {
            cutscene()
        })
    }
})
function cutscene () {
    Saw = sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        `, SpriteKind.Fling)
    animation.runImageAnimation(
    Saw,
    assets.animation`SawBlade`,
    50,
    true
    )
    Saw.setFlag(SpriteFlag.GhostThroughWalls, true)
    Saw.setPosition(scene.cameraProperty(CameraProperty.X) + 100, scene.cameraProperty(CameraProperty.Y))
    Saw.vx = -200
    TreeHits = 20
}
sprites.onOverlap(SpriteKind.Fling, SpriteKind.BackgroundTree, function (sprite, otherSprite) {
    if (TreeHits > 1) {
        TreeHits += -1
        sprite.vx = -200
        sprite.x += 5
        scene.cameraShake(3, 200)
    } else {
        Saw.setFlag(SpriteFlag.Ghost, true)
    }
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Cutscene == false) {
        characterAnimations.clearCharacterState(Character)
        State = "Roll"
        Character.vx = Direction * 150
    }
})
sprites.onOverlap(SpriteKind.Food, SpriteKind.Food, function (sprite, otherSprite) {
    sprite.vy = -25
    sprite.x += -1
    otherSprite.x += 1
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    info.changeScoreBy(1)
    sprites.destroy(otherSprite)
    music.play(music.createSoundEffect(WaveShape.Noise, 975, 971, 255, 0, 100, SoundExpressionEffect.None, InterpolationCurve.Linear), music.PlaybackMode.UntilDone)
})
let TreeHits = 0
let Saw: Sprite = null
let AppleSprite2: Sprite = null
let AppleSprite: Sprite = null
let Tree: Sprite = null
let CutSprite: Sprite = null
let State = ""
let Cutscene = false
let Direction = 0
let Character: Sprite = null
scene.setBackgroundColor(8)
Character = sprites.create(assets.image`Character`, SpriteKind.Player)
characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight))
scene.cameraFollowSprite(Character)
Character.ay = 300
SetupAnim()
tiles.setCurrentTilemap(tilemap`Grassy Yards`)
tiles.placeOnTile(Character, tiles.getTileLocation(0, 8))
music.play(music.createSong(assets.song`Grassy Yards`), music.PlaybackMode.LoopingInBackground)
Direction = 1
let Level = 1
Cutscene = false
State = "Idle"
CutSprite = sprites.create(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `, SpriteKind.HUD)
SpawnStuff()
game.onUpdate(function () {
    if (Character.vx < 5 && Character.vx > -5 && State == "Rolling") {
        animation.stopAnimation(animation.AnimationTypes.All, Character)
        State = "Idle"
        characterAnimations.clearCharacterState(Character)
    } else if (State == "Roll") {
        characterAnimations.clearCharacterState(Character)
        State = "Rolling"
        if (Direction == 1) {
            animation.runImageAnimation(
            Character,
            assets.animation`RollR`,
            75,
            true
            )
        } else if (Direction == -1) {
            animation.runImageAnimation(
            Character,
            assets.animation`RollL`,
            75,
            true
            )
        }
    } else if (State == "Rolling") {
    	
    } else {
        if (Character.vx > 5) {
            State = "Walk"
            characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingRight))
            Direction = 1
        } else if (Character.vx < -5) {
            State = "Walk"
            characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft))
            Direction = -1
        } else if (Character.vy != 0) {
            if (Direction == 1) {
                State = "Jump"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingRight))
            } else if (Direction == -1) {
                State = "Jump"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft))
            }
        } else if (Character.vx < 5 && Character.vx > -5 && Character.vy == 0) {
            if (Direction == 1) {
                State = "Idle"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight))
            } else if (Direction == -1) {
                State = "Idle"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingLeft))
            }
        }
    }
    CutSprite.setPosition(scene.cameraProperty(CameraProperty.X), scene.cameraProperty(CameraProperty.Y))
})
game.onUpdate(function () {
    if (Cutscene == false) {
        if (!(State == "Rolling")) {
            if (controller.right.isPressed()) {
                Character.vx += 2
            } else if (controller.left.isPressed()) {
                Character.vx += -2
            } else {
                Character.vx += Character.vx * -0.1
            }
        } else {
            Character.vx += Character.vx * -0.1
        }
        if (Character.vx > 65) {
            Character.vx = 65
        } else if (Character.vx < -65) {
            Character.vx = -65
        }
    } else {
        Character.vx += Character.vx * -0.1
    }
})
