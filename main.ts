namespace SpriteKind {
    export const HUD = SpriteKind.create()
    export const BackgroundTree = SpriteKind.create()
    export const Fling = SpriteKind.create()
    export const Claw = SpriteKind.create()
    export const TakeAwayTree = SpriteKind.create()
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Cutscene == false) {
        if (Character.vy == 0) {
            Character.vy = -100
        }
    }
})
function SpawnStuff () {
    Tree = sprites.create(assets.image`tree`, SpriteKind.BackgroundTree)
    tiles.placeOnTile(Tree, tiles.getTileLocation(76, 6))
    Tree.z = -2
    for (let AppleSpawn of tiles.getTilesByType(assets.tile`AppleSpawn`)) {
        AppleSprite = sprites.create(assets.image`Apple`, SpriteKind.Food)
        tiles.placeOnTile(AppleSprite, AppleSpawn)
        AppleSprite.ay = 300
        AppleSprite.x += randint(0, -8)
        AppleSprite2 = sprites.create(assets.image`Apple`, SpriteKind.Food)
        tiles.placeOnTile(AppleSprite2, AppleSpawn)
        AppleSprite2.ay = 300
        AppleSprite2.x += randint(0, 7)
        tiles.setTileAt(AppleSpawn, assets.tile`G1-2`)
    }
}
function SetupAnim () {
    characterAnimations.loopFrames(
    Character,
    assets.animation`IdleR`,
    200,
    characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`IdleL`,
    200,
    characterAnimations.rule(Predicate.NotMoving, Predicate.FacingLeft)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`WalkR`,
    100,
    characterAnimations.rule(Predicate.Moving, Predicate.FacingRight)
    )
    characterAnimations.loopFrames(
    Character,
    assets.animation`WalkL`,
    100,
    characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft)
    )
}
scene.onOverlapTile(SpriteKind.Player, assets.tile`transparency16`, function (sprite, location) {
    if (Character.tilemapLocation().column == 79 && Character.tilemapLocation().row == 7 && Cutscene == false) {
        music.stopAllSounds()
        Cutscene = true
        CutscenePart = 1
        CutSprite = sprites.create(img`
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            `, SpriteKind.HUD)
        CutSprite.z = 2
        CutSprite.setPosition(scene.cameraProperty(CameraProperty.X), scene.cameraProperty(CameraProperty.Y))
        animation.runImageAnimation(
        CutSprite,
        assets.animation`Cutscene Bars`,
        100,
        false
        )
        music.play(music.createSong(assets.song`Cutscene 1`), music.PlaybackMode.LoopingInBackground)
        timer.after(1000, function () {
            cutscene()
        })
    }
})
sprites.onDestroyed(SpriteKind.TakeAwayTree, function (sprite) {
    Character.ax = -54
    timer.background(function () {
        pauseUntil(() => Character.x < 1236)
        Character.ax = 0
        Character.sayText("What was that?", 3000, true)
        timer.after(3500, function () {
            Direction = 1
            Character.sayText("I must stop them!", 2000, true)
            timer.after(2500, function () {
                timer.background(function () {
                    Character.ax = 250
                    pauseUntil(() => Character.x > 1275)
                    Character.ax = 100
                    animation.runImageAnimation(
                    CutSprite,
                    assets.animation`Next Level Blackout`,
                    100,
                    false
                    )
                })
            })
        })
    })
})
function cutscene () {
    if (CutscenePart == 1) {
        Saw = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `, SpriteKind.Fling)
        animation.runImageAnimation(
        Saw,
        assets.animation`SawBlade`,
        50,
        true
        )
        Saw.setFlag(SpriteFlag.GhostThroughWalls, true)
        Saw.setPosition(scene.cameraProperty(CameraProperty.X) + 100, scene.cameraProperty(CameraProperty.Y))
        Saw.vx = -200
        TreeHits = 20
    } else if (CutscenePart == 2) {
    	
    } else if (CutscenePart == 3) {
        timer.after(1000, function () {
            Claw = sprites.create(img`
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                . . . . . . . . . . . . . . . . 
                `, SpriteKind.Claw)
            animation.runImageAnimation(
            Claw,
            assets.animation`clawHover`,
            100,
            true
            )
            Claw.setPosition(Tree.x - 18, scene.cameraProperty(CameraProperty.Y) - 80)
            Claw.vy = 35
            Claw.setFlag(SpriteFlag.GhostThroughWalls, true)
            scene.centerCameraAt(scene.cameraProperty(CameraProperty.X), scene.cameraProperty(CameraProperty.Y) - 6)
            CutSprite.setPosition(scene.cameraProperty(CameraProperty.X), scene.cameraProperty(CameraProperty.Y))
        })
    } else if (CutscenePart == 0) {
        timer.after(1000, function () {
            Character.ax = 64
            timer.after(3150, function () {
                Character.ax = 0
                timer.after(500, function () {
                    Direction = -1
                    Character.sayText("Thank you, Mr. Tree!", 2000, true)
                    timer.after(4000, function () {
                        Character.sayText("What's that you say?", 2000, true)
                        timer.after(4000, function () {
                            Character.sayText("Trees are being chopped down?!", 3000, true)
                            timer.after(5000, function () {
                                Character.sayText("I have to stop who ever is doing this!", 3000, true)
                                timer.after(5000, function () {
                                    Direction = 1
                                    Cutscene = false
                                    music.stopAllSounds()
                                    music.play(music.createSong(assets.song`Grassy Yards`), music.PlaybackMode.LoopingInBackground)
                                    sprites.destroy(CutSprite)
                                })
                            })
                        })
                    })
                })
            })
        })
    }
}
sprites.onOverlap(SpriteKind.Fling, SpriteKind.BackgroundTree, function (sprite, otherSprite) {
    if (TreeHits > 1) {
        CutscenePart = 2
        TreeHits += -1
        sprite.vx = -200
        sprite.x += 5
        scene.cameraShake(2, 200)
    } else {
        Saw.setFlag(SpriteFlag.Ghost, true)
        Saw.setFlag(SpriteFlag.AutoDestroy, true)
        timer.background(function () {
            for (let index = 0; index < 15; index++) {
                sprite.x += 1
            }
        })
        animation.runImageAnimation(
        otherSprite,
        assets.animation`treeFall`,
        50,
        false
        )
        timer.after(500, function () {
            Direction = -1
            CutscenePart = 3
            cutscene()
        })
    }
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (Cutscene == false) {
        characterAnimations.clearCharacterState(Character)
        State = "Roll"
        Character.vx = Direction * 150
    }
})
sprites.onOverlap(SpriteKind.Claw, SpriteKind.BackgroundTree, function (sprite, otherSprite) {
    otherSprite.setKind(SpriteKind.TakeAwayTree)
    sprite.vy = 0
    CutscenePart = 4
    animation.runImageAnimation(
    sprite,
    assets.animation`clawYoink`,
    100,
    false
    )
    timer.after(800, function () {
        animation.runImageAnimation(
        sprite,
        assets.animation`clawFlyAway`,
        50,
        true
        )
        timer.after(500, function () {
            CutscenePart = 5
            sprite.ay = -25
            sprite.ax = 50
            otherSprite.ay = -25
            otherSprite.ax = 50
            sprite.setFlag(SpriteFlag.AutoDestroy, true)
            otherSprite.setFlag(SpriteFlag.AutoDestroy, true)
            otherSprite.setFlag(SpriteFlag.GhostThroughWalls, true)
        })
    })
})
sprites.onOverlap(SpriteKind.Food, SpriteKind.Food, function (sprite, otherSprite) {
    sprite.vy = -25
    sprite.x += -1
    otherSprite.x += 1
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    info.changeScoreBy(1)
    sprites.destroy(otherSprite)
    music.play(music.createSoundEffect(WaveShape.Noise, 975, 971, 255, 0, 100, SoundExpressionEffect.None, InterpolationCurve.Linear), music.PlaybackMode.UntilDone)
})
let Claw: Sprite = null
let TreeHits = 0
let Saw: Sprite = null
let AppleSprite2: Sprite = null
let AppleSprite: Sprite = null
let Tree: Sprite = null
let State = ""
let Cutscene = false
let Direction = 0
let CutSprite: Sprite = null
let Character: Sprite = null
let CutscenePart = 0
scene.setBackgroundColor(8)
CutscenePart = 1
Character = sprites.create(assets.image`Character`, SpriteKind.Player)
characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight))
scene.cameraFollowSprite(Character)
Character.ay = 300
SetupAnim()
tiles.setCurrentTilemap(tilemap`Grassy Yards`)
tiles.placeOnTile(Character, tiles.getTileLocation(0, 8))
music.play(music.createSong(assets.song`Introduction0`), music.PlaybackMode.LoopingInBackground)
CutSprite = sprites.create(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `, SpriteKind.HUD)
CutSprite.z = 2
CutSprite.setPosition(scene.cameraProperty(CameraProperty.X), scene.cameraProperty(CameraProperty.Y))
animation.runImageAnimation(
CutSprite,
assets.animation`Cutscene Bars Small`,
100,
false
)
Direction = 1
let Level = 1
Cutscene = true
CutscenePart = 0
State = "Idle"
SpawnStuff()
cutscene()
game.onUpdate(function () {
    if (Character.vx < 5 && Character.vx > -5 && State == "Rolling") {
        animation.stopAnimation(animation.AnimationTypes.All, Character)
        State = "Idle"
        characterAnimations.clearCharacterState(Character)
    } else if (State == "Roll") {
        characterAnimations.clearCharacterState(Character)
        State = "Rolling"
        if (Direction == 1) {
            animation.runImageAnimation(
            Character,
            assets.animation`RollR`,
            75,
            true
            )
        } else if (Direction == -1) {
            animation.runImageAnimation(
            Character,
            assets.animation`RollL`,
            75,
            true
            )
        }
    } else if (State == "Rolling") {
    	
    } else {
        if (Character.vx > 5) {
            State = "Walk"
            characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingRight))
            Direction = 1
        } else if (Character.vx < -5) {
            State = "Walk"
            characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft))
            Direction = -1
        } else if (Character.vy != 0) {
            if (Direction == 1) {
                State = "Jump"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingRight))
            } else if (Direction == -1) {
                State = "Jump"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.Moving, Predicate.FacingLeft))
            }
        } else if (Character.vx < 5 && Character.vx > -5 && Character.vy == 0) {
            if (Direction == 1) {
                State = "Idle"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingRight))
            } else if (Direction == -1) {
                State = "Idle"
                characterAnimations.setCharacterState(Character, characterAnimations.rule(Predicate.NotMoving, Predicate.FacingLeft))
            }
        }
    }
})
game.onUpdate(function () {
    if (Cutscene == false) {
        if (!(State == "Rolling")) {
            if (controller.right.isPressed()) {
                Character.vx += 2
            } else if (controller.left.isPressed()) {
                Character.vx += -2
            } else {
                Character.vx += Character.vx * -0.1
            }
        } else {
            Character.vx += Character.vx * -0.1
        }
        if (Character.vx > 65) {
            Character.vx = 65
        } else if (Character.vx < -65) {
            Character.vx = -65
        }
    } else {
        Character.vx += Character.vx * -0.1
    }
})
